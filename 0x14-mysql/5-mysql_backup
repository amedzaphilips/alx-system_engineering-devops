#!/usr/bin/env bash

# Check if the user provided the password as an argument
if [ -z "$1" ]; then
    echo "Usage: $0 <mysql_root_password>"
    exit 1
fi

# MySQL root password
MYSQL_ROOT_PASSWORD=$1

# Define the backup filename
BACKUP_FILE="backup.sql"

# Get the current date in the format day-month-year
DATE=$(date +"%d-%m-%Y")

# Define the name of the compressed archive
ARCHIVE_FILE="$DATE.tar.gz"

# Generate the MySQL dump
mysqldump -u root -p"$MYSQL_ROOT_PASSWORD" --all-databases > "$BACKUP_FILE"

# Check if the dump was successful
if [ $? -eq 0 ]; then
    echo "MySQL dump created successfully."

    # Compress the dump file into a tar.gz archive
    tar -czvf "$ARCHIVE_FILE" "$BACKUP_FILE"

    # Check if the compression was successful
    if [ $? -eq 0 ]; then
        echo "Backup file compressed successfully: $ARCHIVE_FILE"
        # Remove the uncompressed SQL dump
        rm "$BACKUP_FILE"
    else
        echo "Error compressing the backup file."
    fi
else
    echo "Error creating MySQL dump."
fi

